function pre_processor_hauling

global S

warning('off' ,'all');
javaaddpath(which('MatlabGarbageCollector.jar'));
org.dt.matlab.utilities.JavaMemoryCleaner.clear(1);
clc;
                   
S.f = figure('NumberTitle','off','Name','LHV Tool - Pre-processor',...
             'color','w','toolbar','none','menubar','none','Units','Normalized',...
             'Position',[0.2 0.15 0.8 0.75],'visible','off');
         
global start_window
start_window=1;

dirData = dir('library/tyres');
dirIndex = [dirData.isdir];
filelist = {dirData(~dirIndex).name}';              

S.back_button = uicontrol('style','pushbutton',...
                    'BackgroundColor','w',...
                    'String','Back',...
                    'FontSize',10,...
                    'FontWeight','bold',...
                    'ForeGroundColor','r',...
                    'FontUnits','Normalized',...
                    'units','normalized',...
                    'position',[0.005 0.94 0.1 0.05],...
                    'Callback',@Back_callback);
                
S.next_button = uicontrol('style','pushbutton',...
                    'BackgroundColor','w',...
                    'String','Next',...
                    'FontSize',10,...
                    'FontWeight','bold',...
                    'FontUnits','Normalized',...
                    'ForeGroundColor','b',...
                    'units','normalized',...
                    'Visible','off',...
                    'position',[0.895 0.94 0.1 0.05],...
                    'Callback',@Next_callback);
                      
S.panel_axles = uipanel(S.f,'Title','Axles',...
                         'Units','Centimeters',...
                         'Position',[0.1 0.1 24 10],...
                      'FontSize',12,...
                      'FontWeight','bold',...
                      'backgroundcolor','w',...
                      'Units','Normalized',...
                      'FontUnits','Normalized',...
                      'visible','off',...
                       'BorderWidth',2,...
                       'BorderType','Line',...
                       'highlightcolor','k');
                  
S.panel_axle_1 = uipanel(S.panel_axles,'Title','Axle 1',...
                         'Units','Centimeters',...
                         'Position',[0.1 0.1 5 9],...
                         'FontSize',10,...
                         'FontWeight','bold',...
                         'backgroundcolor','w',...
                         'Units','Normalized',...
                         'FontUnits','Normalized',...
                         'visible','off',...
                         'BorderWidth',2,...
                         'BorderType','Line',...
                         'highlightcolor','k');

S.panel_axle_2 = uipanel(S.panel_axles,'Title','Axle 2',...
                         'Units','Centimeters',...
                         'Position',[5.2 0.1 5 9],...
                       'FontSize',10,...
                       'FontWeight','bold',...
                       'backgroundcolor','w',...
                       'Units','Normalized',...
                       'FontUnits','Normalized',...
                      'visible','off',...
                       'BorderWidth',2,...
                       'BorderType','Line',...
                       'highlightcolor','k');

S.panel_axle_3 = uipanel(S.panel_axles,'Title','Axle 3',...
                         'Units','Centimeters',...
                         'Position',[11 0.1 5 9],...
                         'FontSize',10,...
                         'FontWeight','bold',...
                         'backgroundcolor','w',...
                         'Units','Normalized',...
                         'visible','off',...
                         'FontUnits','Normalized',...
                         'BorderWidth',2,...
                         'BorderType','Line',...
                         'highlightcolor','k');

S.panel_axle_4 = uipanel(S.panel_axles,'Title','Axle 4',...
                         'Units','Centimeters',...
                         'Position',[17 0.1 5 9],...
                       'FontSize',10,...
                       'FontWeight','bold',...
                       'backgroundcolor','w',...
                       'Units','Normalized',...
                       'FontUnits','Normalized',...
                      'visible','off',...
                       'BorderWidth',2,...
                       'BorderType','Line',...
                       'highlightcolor','k');
                   
S.chassis_panel = uipanel(S.f,'Title','Chassis',...
                         'Units','Centimeters',...
                         'Position',[26 5.5 5 9],...
                        'FontSize',12,...
                        'FontWeight','bold',...
                        'backgroundcolor','w',...
                        'FontUnits','Normalized',...
                        'Units','Normalized',...
                        'visible','off',...
                       'BorderWidth',2,...
                       'BorderType','Line',...
                       'highlightcolor','k');
 
S.front_panel = uipanel(S.chassis_panel,'Title','Front',...
                         'Units','Centimeters',...
                         'Position',[0.1 5.5 4.7 3],...
                      'FontSize',10,...
                      'FontWeight','bold',...
                      'backgroundcolor','w',...
                      'Units','Normalized',...
                      'FontUnits','Normalized',...
                      'visible','off',...
                       'BorderWidth',2,...
                       'BorderType','Line',...
                       'highlightcolor','k');

S.rear_panel = uipanel(S.chassis_panel,'Title','Rear',...
                         'Units','Centimeters',...
                         'Position',[0.1 2.25 4.7 3],...
                     'FontSize',10,...
                     'FontWeight','bold',...
                     'backgroundcolor','w',...
                     'Units','Normalized',...
                     'FontUnits','Normalized',...
                     'visible','off',...
                       'BorderWidth',2,...
                       'BorderType','Line',...
                       'highlightcolor','k');

S.connection_panel = uipanel(S.chassis_panel,'Title','Connection',...
                         'Units','Centimeters',...
                         'Position',[0.1 0.1 4.7 2],...
                           'FontSize',10,...
                           'FontWeight','bold',...
                           'backgroundcolor','w',...
                           'Units','Normalized',...
                           'FontUnits','Normalized',...
                           'visible','off',...
                       'BorderWidth',2,...
                       'BorderType','Line',...
                       'highlightcolor','k');

S.load_panel = uipanel(S.f,'Title','Load',...
                       'Units','Centimeters',...
                       'Position',[26 0.1 5 5],...
                       'FontSize',12,...
                       'FontWeight','bold',...
                       'backgroundcolor','w',...
                       'Units','Normalized',...
                       'FontUnits','Normalized',...
                       'visible','off',...
                       'BorderWidth',2,...
                       'BorderType','Line',...
                       'highlightcolor','k');
                   
S.axlesnumber_panel = uibuttongroup(S.f,'Title','Number of axles',...
                       'Position',[0.4 0.3 0.2 0.4],...
                       'FontSize',10,...
                       'FontWeight','bold',...
                       'backgroundcolor','w',...
                       'Units','Normalized',...
                       'visible','on',...
                       'FontUnits','Normalized',...
                       'BorderWidth',2,...
                       'BorderType','Line',...
                       'highlightcolor','k');                   

S.axle2_radiobutton = uicontrol(S.axlesnumber_panel,...
                                'Style','radiobutton',...
                                'String','2',...
                                'backgroundcolor','w',...
                                'Units','Normalized',...
                               'FontSize',10,...
                               'Value',1,...
                                'FontUnits','Normalized',...
                                'Position',[0.45 0.7 0.2 0.2]); 
                   
S.axle3_radiobutton = uicontrol(S.axlesnumber_panel,...
                                'Style','radiobutton',...
                                'String','3',...
                                'backgroundcolor','w',...
                               'FontSize',10,...
                                'FontUnits','Normalized',...
                                'Value',0,...
                                'Units','Normalized',...
                                'Position',[0.45 0.5 0.2 0.2]); 
      
S.axle4_radiobutton = uicontrol(S.axlesnumber_panel,...
                                'Style','radiobutton',...
                                'String','4',...
                                'backgroundcolor','w',...
                               'FontSize',10,...
                                'FontUnits','Normalized',...
                                'Value',0,...
                                'Units','Normalized',...
                                'Position',[0.45 0.3 0.2 0.2]); 
                            
S.applyconfig_button = uicontrol(S.axlesnumber_panel,...
                               'Style','pushbutton',...
                               'String','Apply',...
                               'backgroundcolor','w',...
                               'Units','Normalized',...
                               'Units','Centimeters',...
                               'Position',[1 1 4 1],...
                               'FontSize',10,...
                               'FontUnits','Normalized',...
                               'FontWeight','bold',...
                               'Callback',@applynumofaxles_button_call);

S.config_panel = uibuttongroup(S.f,'Title','4 axles configuration',...
                               'Units','Centimeters',...
                               'Position',[6 8 16 2],...
                               'FontSize',10,...
                               'FontWeight','bold',...
                               'backgroundcolor','w',...
                               'Units','Normalized',...
                               'visible','off',...
                               'FontUnits','Normalized',...
                               'BorderWidth',2,...
                               'BorderType','Line',...
                               'highlightcolor','k');                   

S.config1_radiobutton = uicontrol(S.config_panel,...
                                'Style','radiobutton',...
                                'String','Steer - Steer - Drive - Drive',...
                                'backgroundcolor','w',...
                                'Units','Normalized',...
                               'FontSize',14,...
                               'Value',1,...
                                'FontUnits','Normalized',...
                                'Position',[0.05 0.5 0.5 0.3]); 
                   
S.config2_radiobutton = uicontrol(S.config_panel,...
                                'Style','radiobutton',...
                                'String','Steer - Drive - Drive - Steer',...
                                'backgroundcolor','w',...
                               'FontSize',14,...
                                'FontUnits','Normalized',...
                                'Value',0,...
                                'Units','Normalized',...
                                'Position',[0.45 0.5 0.5 0.3]); 
                            
S.applyconfig_button = uicontrol(S.config_panel,...
                               'Style','pushbutton',...
                               'String','Apply',...
                               'backgroundcolor','w',...
                               'Units','Normalized',...
                               'Position',[0.825 0.45 0.15 0.45],...
                               'FontSize',10,...
                               'FontUnits','Normalized',...
                               'FontWeight','bold',...
                               'Callback',@applyconfig_button_call);                           
%% Axle 1

S.axle1xpos_edit = uicontrol(S.panel_axle_1,'Style','edit',...
                           'Units','normalized',...
                           'Position',[.6 .9 .3 .065],...
                           'FontSize',7,...
                           'FontUnits','Normalized');
                       
S.axle1xpos_text = uicontrol(S.panel_axle_1,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.9 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','X position (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                       
S.axle1trackwidth_edit = uicontrol(S.panel_axle_1,'Style','edit',...
                                 'Units','normalized',...
                                 'Position',[.6 .81 .3 .065],...
                                 'FontSize',7,...
                                 'FontUnits','Normalized');

S.axle1trackwidth_text = uicontrol(S.panel_axle_1,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.81 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Distance ''D'' (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle1zrollcenter_edit = uicontrol(S.panel_axle_1,'Style','edit',...
                                  'Units','normalized',...
                                  'Position',[.6 .72 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
                              
S.axle1zrollcenter_text = uicontrol(S.panel_axle_1,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.72 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Roll center Z position(m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle1yd_edit = uicontrol(S.panel_axle_1,'Style','edit',...
                         'Units','normalized',...
                         'Position',[.6 .63 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
                     
S.axle1yd_text = uicontrol(S.panel_axle_1,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.63 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Y distance btw dampers (m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle1ys_edit = uicontrol(S.panel_axle_1,'Style','edit',...
                         'Units','normalized',...
                         'Position',[.6 .54 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
                     
S.axle1ys_text = uicontrol(S.panel_axle_1,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.54 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Y distance btw springs (m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle1fzstat_edit = uicontrol(S.panel_axle_1,'Style','edit',...
                             'Units','normalized',...
                             'Position',[.6 .45 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle1fzstat_text = uicontrol(S.panel_axle_1,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.45 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Initial load (N)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle1mass_edit = uicontrol(S.panel_axle_1,'Style','edit',...
                           'Units','normalized',...
                           'Position',[.6 .36 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
                       
S.axle1mass_text = uicontrol(S.panel_axle_1,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.36 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Mass excl wheels/tyres (kg)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle1damper_edit = uicontrol(S.panel_axle_1,'Style','edit',...
                             'Units','normalized',...
                             'Position',[.6 .27 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle1damper_text = uicontrol(S.panel_axle_1,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.27 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Damper constant (Ns/m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle1spring_edit = uicontrol(S.panel_axle_1,'Style','edit',...
                             'Units','normalized',...
                             'Position',[.6 .18 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle1spring_text = uicontrol(S.panel_axle_1,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.18 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Spring stiffness (N/m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle1roll_edit = uicontrol(S.panel_axle_1,'Style','edit',...
                           'Units','normalized',...
                           'Position',[.6 0.09 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');  
                       
S.axle1roll_text = uicontrol(S.panel_axle_1,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.09 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Roll stiffness (Nm/rad)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                                                   
S.axle1tyres_text = uicontrol(S.panel_axle_1,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Tyres',...
                             'FontSize',7,...
                             'FontUnits','Normalized');                             
%% Axle 2      

S.axle2xpos_edit = uicontrol(S.panel_axle_2,'Style','edit',...
                           'Units','normalized','String','0',...
                           'Position',[.6 .9 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');

S.axle2xpos_text = uicontrol(S.panel_axle_2,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.9 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','X position (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle2trackwidth_edit = uicontrol(S.panel_axle_2,'Style','edit',...
                                 'Units','normalized',...
                                 'Position',[.6 .81 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');

S.axle2trackwidth_text = uicontrol(S.panel_axle_2,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.81 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Distance ''D'' (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle2zrollcenter_edit = uicontrol(S.panel_axle_2,'Style','edit',...
                                  'Units','normalized',...
                                  'Position',[.6 .72 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
  
S.axle2zrollcenter_text = uicontrol(S.panel_axle_2,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.72 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Roll center Z position(m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle2yd_edit = uicontrol(S.panel_axle_2,'Style','edit',...
                         'Units','normalized',...
                         'Position',[.6 .63 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');

S.axle2yd_text = uicontrol(S.panel_axle_2,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.63 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Y distance btw dampers (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle2ys_edit = uicontrol(S.panel_axle_2,'Style','edit',...
                         'Units','normalized',...
                         'Position',[.6 .54 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');

S.axle2ys_text = uicontrol(S.panel_axle_2,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.54 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Y distance btw springs (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle2fzstat_edit = uicontrol(S.panel_axle_2,'Style','edit',...
                             'Units','normalized',...
                             'Position',[.6 .45 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');

S.axle2fzstat_text = uicontrol(S.panel_axle_2,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.45 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Initial load (N)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle2mass_edit = uicontrol(S.panel_axle_2,'Style','edit',...
                           'Units','normalized',...
                           'Position',[.6 .36 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
           
S.axle2mass_text = uicontrol(S.panel_axle_2,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.36 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Mass excl wheels/tyres (kg)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle2damper_edit = uicontrol(S.panel_axle_2,'Style','edit',...
                             'Units','normalized',...
                             'Position',[.6 .27 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
 
S.axle2damper_text = uicontrol(S.panel_axle_2,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.27 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Damper constant (Ns/m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle2spring_edit = uicontrol(S.panel_axle_2,'Style','edit',...
                             'Units','normalized',...
                             'Position',[.6 .18 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');

S.axle2spring_text = uicontrol(S.panel_axle_2,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.18 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Spring stiffness (N/m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle2roll_edit = uicontrol(S.panel_axle_2,'Style','edit',...
                           'Units','normalized',...
                           'Position',[.6 .09 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');  
 
S.axle2roll_text = uicontrol(S.panel_axle_2,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.09 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Roll stiffness (Nm/rad)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle2tyres_text = uicontrol(S.panel_axle_2,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Tyres',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');                               
%% Axle 3      

S.axle3xpos_edit = uicontrol(S.panel_axle_3,'Style','edit',...
                           'Units','normalized','String','0',...
                           'Position',[.6 .9 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');

S.axle3xpos_text = uicontrol(S.panel_axle_3,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.9 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','X position (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle3trackwidth_edit = uicontrol(S.panel_axle_3,'Style','edit',...
                                 'Units','normalized',...
                                 'Position',[.6 .81 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
   
S.axle3trackwidth_text = uicontrol(S.panel_axle_3,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.81 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Distance ''D'' (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle3zrollcenter_edit = uicontrol(S.panel_axle_3,'Style','edit',...
                                  'Units','normalized',...
                                  'Position',[.6 .72 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
   
S.axle3zrollcenter_text = uicontrol(S.panel_axle_3,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.72 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Roll center Z position(m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle3yd_edit = uicontrol(S.panel_axle_3,'Style','edit',...
                         'Units','normalized',...
                         'Position',[.6 .63 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
     
S.axle3yd_text = uicontrol(S.panel_axle_3,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.63 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Y distance btw dampers (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle3ys_edit = uicontrol(S.panel_axle_3,'Style','edit',...
                         'Units','normalized',...
                         'Position',[.6 .54 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
       
S.axle3ys_text = uicontrol(S.panel_axle_3,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.54 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Y distance btw springs (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle3fzstat_edit = uicontrol(S.panel_axle_3,'Style','edit',...
                             'Units','normalized',...
                             'Position',[.6 .45 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
      
S.axle3fzstat_text = uicontrol(S.panel_axle_3,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.45 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Initial load (N)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle3mass_edit = uicontrol(S.panel_axle_3,'Style','edit',...
                           'Units','normalized',...
                           'Position',[.6 .36 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
           
S.axle3mass_text = uicontrol(S.panel_axle_3,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.36 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Mass excl wheels/tyres (kg)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle3damper_edit = uicontrol(S.panel_axle_3,'Style','edit',...
                             'Units','normalized',...
                             'Position',[.6 .27 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
           
S.axle3damper_text = uicontrol(S.panel_axle_3,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.27 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Damper constant (Ns/m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle3spring_edit = uicontrol(S.panel_axle_3,'Style','edit',...
                             'Units','normalized',...
                             'Position',[.6 .18 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
  
S.axle3spring_text = uicontrol(S.panel_axle_3,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.18 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Spring stiffness (N/m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle3roll_edit = uicontrol(S.panel_axle_3,'Style','edit',...
                           'Units','normalized',...
                           'Position',[.6 .09 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');  
             
S.axle3roll_text = uicontrol(S.panel_axle_3,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.09 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Roll stiffness (Nm/rad)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
          
S.axle3tyres_text = uicontrol(S.panel_axle_3,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Tyres',...
                             'FontSize',7,...
                             'FontUnits','Normalized');                                    
%% Axle 4      

S.axle4xpos_edit = uicontrol(S.panel_axle_4,'Style','edit',...
                           'Units','normalized','String','0',...
                           'Position',[.6 .9 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
 
S.axle4xpos_text = uicontrol(S.panel_axle_4,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.9 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','X position (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle4trackwidth_edit = uicontrol(S.panel_axle_4,'Style','edit',...
                                 'Units','normalized',...
                                 'Position',[.6 .81 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
           
S.axle4trackwidth_text = uicontrol(S.panel_axle_4,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.81 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Distance ''D'' (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle4zrollcenter_edit = uicontrol(S.panel_axle_4,'Style','edit',...
                                  'Units','normalized',...
                                  'Position',[.6 .72 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
           
S.axle4zrollcenter_text = uicontrol(S.panel_axle_4,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.72 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Roll center Z position(m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle4yd_edit = uicontrol(S.panel_axle_4,'Style','edit',...
                         'Units','normalized',...
                         'Position',[.6 .63 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
           
S.axle4yd_text = uicontrol(S.panel_axle_4,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.63 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Y distance btw dampers (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle4ys_edit = uicontrol(S.panel_axle_4,'Style','edit',...
                         'Units','normalized',...
                         'Position',[.6 .54 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
      
S.axle4ys_text = uicontrol(S.panel_axle_4,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.54 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Y distance btw springs (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.axle4fzstat_edit = uicontrol(S.panel_axle_4,'Style','edit',...
                             'Units','normalized',...
                             'Position',[.6 .45 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
           
S.axle4fzstat_text = uicontrol(S.panel_axle_4,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.45 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Initial load (N)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle4mass_edit = uicontrol(S.panel_axle_4,'Style','edit',...
                           'Units','normalized',...
                           'Position',[.6 .36 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
      
S.axle4mass_text = uicontrol(S.panel_axle_4,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.36 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Mass excl wheels/tyres (kg)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle4damper_edit = uicontrol(S.panel_axle_4,'Style','edit',...
                             'Units','normalized',...
                             'Position',[.6 .27 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
         
S.axle4damper_text = uicontrol(S.panel_axle_4,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.27 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Damper constant (Ns/m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle4spring_edit = uicontrol(S.panel_axle_4,'Style','edit',...
                             'Units','normalized',...
                             'Position',[.6 .18 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');
     
S.axle4spring_text = uicontrol(S.panel_axle_4,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.18 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Spring stiffness (N/m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.axle4roll_edit = uicontrol(S.panel_axle_4,'Style','edit',...
                           'Units','normalized',...
                           'Position',[.6 .09 .3 .065],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');  
                   
S.axle4roll_text = uicontrol(S.panel_axle_4,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.09 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Roll stiffness (Nm/rad)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                             
S.axle4tyres_text = uicontrol(S.panel_axle_4,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0 0.45 0.065],...
                             'backgroundcolor','w',...
                             'String','Tyres',...
                             'FontSize',7,...
                             'FontUnits','Normalized');                                 
%% Chassis

S.chassisfrontlenght_edit = uicontrol(S.front_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .85 .2 .15],...
                                  'FontSize',7,...
                             'FontUnits','Normalized'); 
                                
S.chassisfrontlenght_text = uicontrol(S.front_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.87 0.45 0.1],...
                             'backgroundcolor','w',...
                             'String','Distance ''H'' (m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                
S.chassisfrontheight_edit = uicontrol(S.front_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .65 .2 .15],...
                                  'FontSize',7,...
                             'FontUnits','Normalized'); 

S.chassisfrontheight_text = uicontrol(S.front_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.67 0.45 0.1],...
                             'backgroundcolor','w',...
                             'String','Distance ''I'' (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.chassisfrontwidth_edit = uicontrol(S.front_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .45 .2 .15],...
                                  'FontSize',7,...
                             'FontUnits','Normalized'); 

S.chassisfrontwidth_text = uicontrol(S.front_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.47 0.45 0.1],...
                             'backgroundcolor','w',...
                             'String','Distance ''J'' (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.chassisfrontmass_edit = uicontrol(S.front_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .25 .2 .15],...
                                  'FontSize',7,...
                             'FontUnits','Normalized'); 

S.chassisfrontmass_text = uicontrol(S.front_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.27 0.45 0.1],...
                             'backgroundcolor','w',...
                             'String','Mass (kg)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.front2firstaxle_edit = uicontrol(S.front_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .05 .2 .15],...
                                  'FontSize',7,...
                             'FontUnits','Normalized'); 

S.front2firstaxle_text = uicontrol(S.front_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.07 0.45 0.1],...
                             'backgroundcolor','w',...
                             'String','Distance ''T'' (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');                                
%% Rear 

S.chassisrearlenght_edit = uicontrol(S.rear_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .85 .2 .15],...
                                  'FontSize',7,...
                             'FontUnits','Normalized'); 
  
S.chassisrearlenght_text = uicontrol(S.rear_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.87 0.45 0.1],...
                             'backgroundcolor','w',...
                             'String','Distance ''K'' (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.chassisrearheight_edit = uicontrol(S.rear_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .62 .2 .15],...
                                  'FontSize',7,...
                             'FontUnits','Normalized'); 
 
S.chassisrearheight_text = uicontrol(S.rear_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.64 0.45 0.1],...
                             'backgroundcolor','w',...
                             'String','Distance ''L'' (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.chassisrearwidth_edit = uicontrol(S.rear_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .39 .2 .15],...
                                  'FontSize',7,...
                             'FontUnits','Normalized'); 
   
S.chassisrearwidth_text = uicontrol(S.rear_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.41 0.45 0.1],...
                             'backgroundcolor','w',...
                             'String','Distance ''M'' (m)',...
                             'FontSize', 7,...
                             'FontUnits','Normalized');
                         
S.chassisrearmass_edit = uicontrol(S.rear_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .16 .2 .15],...
                                  'FontSize',7,...
                             'FontUnits','Normalized'); 
                              
S.chassisrearmass_text = uicontrol(S.rear_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.18 0.45 0.1],...
                             'backgroundcolor','w',...
                             'String','Mass(kg)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');                              
%% connection

S.connectionxpos_edit = uicontrol(S.connection_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .7 .2 .3],...
                                  'FontSize',7,...
                             'FontUnits','Normalized'); 
 
S.connectionxpos_text = uicontrol(S.connection_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.72 0.45 0.2],...
                             'backgroundcolor','w',...
                             'String','Distance ''N'' (m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');
                         
S.connectionzpos_edit = uicontrol(S.connection_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .2 .2 .3],...
                                  'FontSize',7,...
                             'FontUnits','Normalized');                     
       
S.connectionzpos_text = uicontrol(S.connection_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.24 0.45 0.2],...
                             'backgroundcolor','w',...
                             'String','Distance ''O'' (m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');                              
%% load

S.loadlenght_edit = uicontrol(S.load_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .85 .2 .1],...
                             'FontSize',7,...
                             'FontUnits','Normalized'); 

S.loadlenght_text = uicontrol(S.load_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.75 0.45 0.2],...
                             'backgroundcolor','w',...
                             'String','Distance ''P'' (m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');   
                         
S.loadwidth_edit = uicontrol(S.load_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .7 .2 .1],...
                             'FontSize',7,...
                             'FontUnits','Normalized');
 
S.loadwidth_text = uicontrol(S.load_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.6 0.45 0.2],...
                             'backgroundcolor','w',...
                             'String','Distance ''Q'' (m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');   
                         
S.loadrho_edit = uicontrol(S.load_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .55 .2 .1],...
                             'FontSize',7,...
                             'FontUnits','Normalized'); 

S.loadrho_text = uicontrol(S.load_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.45 0.45 0.2],...
                             'backgroundcolor','w',...
                             'String','Rho (kg/m^3)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');   
                         
S.loadmass_edit = uicontrol(S.load_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 .4 .2 .1],...
                             'FontSize',7,...
                             'FontUnits','Normalized');
  
S.loadmass_text = uicontrol(S.load_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.3 0.45 0.2],...
                             'backgroundcolor','w',...
                             'String','Mass (kg)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');   
                         
S.loadzcoord_edit = uicontrol(S.load_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 0.25 .2 .1],...
                             'FontSize',7,...
                             'FontUnits','Normalized'); 
  
S.loadzcoord_text = uicontrol(S.load_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0.15 0.45 0.2],...
                             'backgroundcolor','w',...
                             'String','Distance ''R'' (m)',...
                             'FontSize',7,...
                             'FontUnits','Normalized');   
                         
S.cgratio_edit = uicontrol(S.load_panel,'Style','edit',...
                                    'Units','normalized',...
                                    'Position',[.7 0.1 .2 .1],...
                             'FontSize',7,...
                             'FontUnits','Normalized');   

S.cgratio_text = uicontrol(S.load_panel,'Style','text',...
                             'Units','Normalized',...
                             'Position',[0.1 0 0.45 0.2],...
                             'backgroundcolor','w',...
                             'String','Center of Gravity Ratio',...
                             'FontSize',7,...
                             'FontUnits','Normalized');   

set(S.axle1xpos_edit,'Enable','Off')

set(S.f,'visible','on');                
pause(1)
figure(S.f)
robot = java.awt.Robot; 
robot.keyPress(java.awt.event.KeyEvent.VK_ALT);      %// send ALT
robot.keyPress(java.awt.event.KeyEvent.VK_SPACE);    %// send SPACE
robot.keyRelease(java.awt.event.KeyEvent.VK_SPACE);  %// release SPACE
robot.keyRelease(java.awt.event.KeyEvent.VK_ALT);    %// release ALT
robot.keyPress(java.awt.event.KeyEvent.VK_X);        %// send X
robot.keyRelease(java.awt.event.KeyEvent.VK_X);      %// release X

function Back_callback(source,eventdata) 
S.S.hWait = figure('NumberTitle','off','Name','LHV Tool',...
             'color','w','toolbar','none','menubar','none','Units','Normalized',...
             'Position',[0.2 0.15 0.8 0.75]);  
pause(0.5)         
robot = java.awt.Robot; 
robot.keyPress(java.awt.event.KeyEvent.VK_ALT);      %// send ALT
robot.keyPress(java.awt.event.KeyEvent.VK_SPACE);    %// send SPACE
robot.keyRelease(java.awt.event.KeyEvent.VK_SPACE);  %// release SPACE
robot.keyRelease(java.awt.event.KeyEvent.VK_ALT);    %// release ALT
robot.keyPress(java.awt.event.KeyEvent.VK_X);        %// send X
robot.keyRelease(java.awt.event.KeyEvent.VK_X);      %// release X         
         
iconsClassName = 'com.mathworks.widgets.BusyAffordance$AffordanceSize';
iconsSizeEnums = javaMethod('values',iconsClassName);
SIZE_32x32 = iconsSizeEnums(2);  % (1) = 16x16,  (2) = 32x32
jObj = com.mathworks.widgets.BusyAffordance(SIZE_32x32, 'Please wait...');  % icon, label
jObj.setPaintsWhenStopped(true);  % default = false
jObj.useWhiteDots(false);         % default = false (true is good for dark backgrounds)
javacomponent(jObj.getComponent, [850,500,200,100], S.S.hWait);
jObj.start;     
pause(1)
closereq
configuration_selection
jObj.stop;
close(S.S.hWait)

function applynumofaxles_button_call(source, eventdata)

global start_window S
start_window=0;
global a axle_tractor choice t1 truck_name tractor_code d p1name 
d = 0;
if (get(S.axle2_radiobutton,'Value') == get(S.axle2_radiobutton,'Max'))
    a=2;
    choice=1;
elseif (get(S.axle3_radiobutton,'Value') == get(S.axle3_radiobutton,'Max'))
    a=3;
    choice=1;
elseif (get(S.axle4_radiobutton,'Value') == get(S.axle4_radiobutton,'Max'))
    a=4;
    choice=0;
end

axle_tractor(1)=a;
tractor_code=t1;
         
% Tractor
if t1==1 && a==2
    p1name = 'TR4x2';
    set(S.panel_axle_1,'Visible','On')
    set(S.panel_axle_2,'Visible','On')
    S.axes1 = axes('Position',[0.01 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('tractor_2a_dim1.bmp');
    image(bg);
    axis off;
    S.axes2 = axes('Position',[0.37 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('tractor_2a_dim2.bmp');
    image(bg);
    axis off;
    set(S.panel_axles,'Visible','On')
    set(S.panel_axle_3,'Visible','Off')
    set(S.panel_axle_4,'Visible','Off')
    set(S.cgratio_text,'Visible','Off')
    set(S.cgratio_edit,'Visible','Off')
%     set(S.cgcomment_text,'Visible','Off')
    set(S.chassis_panel,'Visible','On')
    set(S.front_panel, 'visible','on');
    set(S.rear_panel, 'visible','on');
    set(S.connection_panel,'visible','on');  
    set(S.next_button,'Visible','On')
%     set(S.text,'Visible','On')
    truck_name='tractor_2axles';
elseif t1==1 && a==3
    p1name = 'TR6x4';
    set(S.panel_axle_1,'Visible','On')
    set(S.panel_axle_2,'Visible','On')
    set(S.panel_axle_3,'Visible','On')
    S.axes1 = axes('Position',[0.01 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('tractor_3a_dim1.bmp');
    image(bg);
    axis off;
    S.axes2 = axes('Position',[0.37 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('tractor_3a_dim2.bmp');
    image(bg);
    axis off;
    set(S.panel_axles,'Visible','On')
    set(S.panel_axle_4,'Visible','Off')
    set(S.cgratio_text,'Visible','Off')
    set(S.cgratio_edit,'Visible','Off')
%     set(S.cgcomment_text,'Visible','Off')
    set(S.chassis_panel,'Visible','On')
    set(S.front_panel, 'visible','on');
    set(S.rear_panel, 'visible','on');    
    set(S.connection_panel,'visible','on');  
    set(S.next_button,'Visible','On')
%     set(S.text,'Visible','On')
    truck_name='tractor_3axles';
elseif t1==1 && a==4
    p1name = 'TR8x4';
    set(S.panel_axle_1,'Visible','On')
    set(S.panel_axle_2,'Visible','On')
    set(S.panel_axle_3,'Visible','On')
    set(S.panel_axle_4,'Visible','On')
    set(S.config_panel,'Visible','On')
    set(S.cgratio_text,'Visible','Off')
    set(S.cgratio_edit,'Visible','Off')
%     set(S.cgcomment_text,'Visible','Off')
    truck_name='tractor_4axles';
% Truck without kingpin
elseif t1==2 && a==2
    p1name = 'TK4x2';
    set(S.panel_axle_1,'Visible','On')
    set(S.panel_axle_2,'Visible','On')
    S.axes1 = axes('Position',[0.01 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_a_2a_dim1.bmp');
    image(bg);
    axis off;
    S.axes2 = axes('Position',[0.37 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_a_2a_dim2.bmp');
    image(bg);
    axis off;
    set(S.load_panel,'Visible','On')
    set(S.panel_axles,'Visible','On')
    set(S.panel_axle_3,'Visible','Off')
    set(S.panel_axle_4,'Visible','Off')
    set(S.chassis_panel,'Visible','On')
    set(S.front_panel, 'visible','on');
    set(S.rear_panel, 'visible','on'); 
    set(S.connection_panel,'visible','on');  
    set(S.next_button,'Visible','On')
%     set(S.text,'Visible','On')
    truck_name='truck_2axles';
elseif t1==2 && a==3
    p1name = 'TK6x4';
    set(S.panel_axle_1,'Visible','On')
    set(S.panel_axle_2,'Visible','On')
    set(S.panel_axle_3,'Visible','On')
    S.axes1 = axes('Position',[0.01 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_a_3a_dim1.bmp');
    image(bg);
    axis off;
    S.axes2 = axes('Position',[0.37 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_a_3a_dim2.bmp');
    image(bg);
    axis off;
    set(S.load_panel,'Visible','On')
    set(S.panel_axles,'Visible','On')
    set(S.panel_axle_4,'Visible','Off')
    set(S.chassis_panel,'Visible','On')
    set(S.front_panel, 'visible','on');
    set(S.rear_panel, 'visible','on'); 
    set(S.connection_panel,'visible','on');  
    set(S.next_button,'Visible','On')
%     set(S.text,'Visible','On')
    truck_name='truck_3axles';
elseif t1==2 && a==4
    p1name = 'TK8x4';
    set(S.panel_axle_1,'Visible','On')
    set(S.panel_axle_2,'Visible','On')
    set(S.panel_axle_3,'Visible','On')
    set(S.panel_axle_4,'Visible','On')
    set(S.config_panel,'Visible','On')
    truck_name='truck_4axles';
% Truck with kingpin
elseif t1==3 && a==2
    p1name = 'TL4x2';
    set(S.panel_axle_1,'Visible','On')
    set(S.panel_axle_2,'Visible','On')
    S.axes1 = axes('Position',[0.01 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_b_2a_dim1.bmp');
    image(bg);
    axis off;
    S.axes2 = axes('Position',[0.37 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_b_2a_dim2.bmp');
    image(bg);
    axis off;
    set(S.load_panel,'Visible','On')
    set(S.panel_axles,'Visible','On')
    set(S.panel_axle_3,'Visible','Off')
    set(S.panel_axle_4,'Visible','Off')
    set(S.chassis_panel,'Visible','On')
    set(S.front_panel, 'visible','on');
    set(S.rear_panel, 'visible','on'); 
    set(S.connection_panel,'visible','on');  
    set(S.next_button,'Visible','On')
%     set(S.text,'Visible','On')
    truck_name='truck_2axles';
elseif t1==3 && a==3
    p1name = 'TL6x4';
    set(S.panel_axle_1,'Visible','On')
    set(S.panel_axle_2,'Visible','On')
    set(S.panel_axle_3,'Visible','On')
    S.axes1 = axes('Position',[0.01 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_b_3a_dim1.bmp');
    image(bg);
    axis off;
    S.axes2 = axes('Position',[0.37 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_b_3a_dim2.bmp');
    image(bg);
    axis off;
    set(S.load_panel,'Visible','On')
    set(S.panel_axles,'Visible','On')
    set(S.panel_axle_4,'Visible','Off')
    set(S.chassis_panel,'Visible','On')
    set(S.front_panel, 'visible','on');
    set(S.rear_panel, 'visible','on'); 
    set(S.connection_panel,'visible','on');  
    set(S.next_button,'Visible','On')
%     set(S.text,'Visible','On')
    truck_name='truck_3axles';
elseif t1==3 && a==4
    p1name = 'TL8x4';
    set(S.panel_axle_1,'Visible','On')
    set(S.panel_axle_2,'Visible','On')
    set(S.panel_axle_3,'Visible','On')
    set(S.panel_axle_4,'Visible','On')
    set(S.config_panel,'Visible','On')
    truck_name='truck_4axles';
end
set(S.axlesnumber_panel,'Visible','Off')

dirData = dir('library/tyres');
dirIndex = [dirData.isdir];
filelist = {dirData(~dirIndex).name}';

S.axle1tyres_popupmenu = uicontrol(S.panel_axle_1,'Style','popupmenu',...
                                 'String',filelist,...
                                 'Units','Normalized',...
                                 'Position',[0.6 0 0.35 .065],...
                                 'FontSize',7,...
                                 'FontUnits','Normalized');   
                         
S.axle2tyres_popupmenu = uicontrol(S.panel_axle_2,'Style','popupmenu',...
                                 'String',filelist,...
                                 'Units','Normalized',...
                                 'Position',[0.6 0 0.35 .065],...
                                 'FontSize',7,...
                                 'FontUnits','Normalized');                         
                         
                         
S.axle3tyres_popupmenu = uicontrol(S.panel_axle_3,'Style','popupmenu',...
                                 'String',filelist,...
                                 'Units','Normalized',...
                                 'Position',[0.6 0 0.35 .065],...
                                 'FontSize',7,...
                                 'FontUnits','Normalized');                    
                         
                         
S.axle4tyres_popupmenu = uicontrol(S.panel_axle_4,'Style','popupmenu',...
                                 'String',filelist,...
                                 'Units','Normalized',...
                                 'Position',[0.6 0 0.35 .065],...
                                 'FontSize',7,...
                                 'FontUnits','Normalized');     
                         
if a==2
    valaxle1=2;
    valaxle2=1;
    set(S.axle1tyres_popupmenu,'Value',valaxle1);
    set(S.axle2tyres_popupmenu,'Value',valaxle2);
elseif a==3
    valaxle1=2;
    valaxle2=1;
    set(S.axle1tyres_popupmenu,'Value',valaxle1);
    set(S.axle2tyres_popupmenu,'Value',valaxle2);
    set(S.axle3tyres_popupmenu,'Value',valaxle2);
end          

if choice==1
    Tractor_initialize
end

% --- Executes on button press in applyconfig_button.
function applyconfig_button_call(source, eventdata)
global a choice conf t1 S
if t1==1 && a==4 && (get(S.config1_radiobutton,'Value') == get(S.config1_radiobutton,'Max'))
    conf=1;
    S.axes1 = axes('Position',[0.01 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('tractor_4a_conf1_dim1.bmp');
    image(bg);
    axis off;
    S.axes2 = axes('Position',[0.37 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('tractor_4a_conf1_dim2.bmp');
    image(bg);
    axis off;
elseif t1==1 && a==4 && (get(S.config2_radiobutton,'Value') == get(S.config1_radiobutton,'Max'))
    conf=2;
    S.axes1 = axes('Position',[0.01 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('tractor_4a_conf2_dim1.bmp');
    image(bg);
    axis off;
    S.axes2 = axes('Position',[0.37 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('tractor_4a_conf2_dim2.bmp');
    image(bg);
    axis off;
elseif t1==2 && a==4 && (get(S.config1_radiobutton,'Value') == get(S.config1_radiobutton,'Max'))
    conf=1;
    S.axes1 = axes('Position',[0.01 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_a_4a_conf1_dim1.bmp');
    image(bg);
    axis off;
    S.axes2 = axes('Position',[0.37 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_a_4a_conf1_dim2.bmp');
    image(bg);
    axis off;
    set(S.load_panel,'Visible','On')
elseif t1==2 && a==4 && (get(S.config2_radiobutton,'Value') == get(S.config1_radiobutton,'Max'))
    conf=2;
    S.axes1 = axes('Position',[0.01 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_a_4a_conf2_dim1.bmp');
    image(bg);
    axis off;
    S.axes2 = axes('Position',[0.37 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_a_4a_conf2_dim2.bmp');
    image(bg);
    axis off;
    set(S.load_panel,'Visible','On')
elseif t1==3 && a==4 && (get(S.config1_radiobutton,'Value') == get(S.config1_radiobutton,'Max'))
    conf=1;
    S.axes1 = axes('Position',[0.01 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_b_4a_conf1_dim1.bmp');
    image(bg);
    axis off;
    S.axes2 = axes('Position',[0.37 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_b_4a_conf1_dim2.bmp');
    image(bg);
    axis off;
    set(S.load_panel,'Visible','On')
elseif t1==3 && a==4 && (get(S.config2_radiobutton,'Value') == get(S.config1_radiobutton,'Max'))
    conf=2;
    S.axes1 = axes('Position',[0.01 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_b_4a_conf2_dim1.bmp');
    image(bg);
    axis off;
    S.axes2 = axes('Position',[0.37 0.6 0.35 0.35],...
             'Units','Normalized');
    bg = imread('truck_b_4a_conf2_dim2.bmp');
    image(bg);
    axis off;
    set(S.load_panel,'Visible','On')
end
set(S.panel_axles,'Visible','On')
set(S.chassis_panel,'Visible','On')
set(S.front_panel, 'visible','on');
set(S.rear_panel, 'visible','on');
set(S.connection_panel,'visible','on');  
set(S.next_button,'Visible','On')
% set(S.text,'Visible','On')
set(S.config_panel,'Visible','Off')

if a==4 && conf==1
    valaxle1=2;
    valaxle2=1;
    set(S.axle1tyres_popupmenu,'Value',valaxle1);
    set(S.axle2tyres_popupmenu,'Value',valaxle1);
    set(S.axle3tyres_popupmenu,'Value',valaxle2);
    set(S.axle4tyres_popupmenu,'Value',valaxle2);
elseif a==4 && conf==2
    valaxle1=2;
    valaxle2=1;
    set(S.axle1tyres_popupmenu,'Value',valaxle1);
    set(S.axle2tyres_popupmenu,'Value',valaxle2);
    set(S.axle3tyres_popupmenu,'Value',valaxle2);
    set(S.axle4tyres_popupmenu,'Value',valaxle1);
end
choice=1;

Tractor_initialize %put values in edit boxes
set(S.next_button,'Visible','On')

function Next_callback(source, eventdata)
global start_window
start_window=0;
global a c file_name p t1 truck_name tractor S

    %% CREATING MAXIMIZED WAIT SCREEN
S.hWait = figure('NumberTitle','off','Name','LHV Tool',...
             'color','w','toolbar','none','menubar','none','Units','Normalized',...
             'Position',[0.2 0.15 0.8 0.75]);  

% MAXIMIZE WINDOW
pause(0.5)         
robot = java.awt.Robot; 
robot.keyPress(java.awt.event.KeyEvent.VK_ALT);      %// send ALT
robot.keyPress(java.awt.event.KeyEvent.VK_SPACE);    %// send SPACE
robot.keyRelease(java.awt.event.KeyEvent.VK_SPACE);  %// release SPACE
robot.keyRelease(java.awt.event.KeyEvent.VK_ALT);    %// release ALT
robot.keyPress(java.awt.event.KeyEvent.VK_X);        %// send X
robot.keyRelease(java.awt.event.KeyEvent.VK_X);      %// release X         
         
% EXECUTE JAVA OBJECT
iconsClassName = 'com.mathworks.widgets.BusyAffordance$AffordanceSize';
iconsSizeEnums = javaMethod('values',iconsClassName);
SIZE_32x32 = iconsSizeEnums(2);  % (1) = 16x16,  (2) = 32x32
jObj = com.mathworks.widgets.BusyAffordance(SIZE_32x32, 'Start up, please wait...');  % icon, label
jObj.setPaintsWhenStopped(true);  % default = false
jObj.useWhiteDots(false);         % default = false (true is good for dark backgrounds)
javacomponent(jObj.getComponent, [850,500,200,100], S.hWait);
jObj.start;     
pause(1)

%% Create empty simulation model
% Define the name
file_name  = 'LZV_custom';
file_name_ext = strcat( file_name, 'mdl' );

% If the model already exists, delete it
d  = dir(file_name_ext);
sd = size(d);
if sd(1,1) ~= 0 
  disp(['deleting existing Simulink model ',file_name_ext])
  delete file_name_ext;
end 
    
if t1==1
    tractor=1;
elseif t1==2
    tractor=0;
elseif t1==3
    tractor=0;
end

%Create the simulink model
new_system(file_name, 'Model')
set_param(file_name,'Solver','ode45');

%% Add user defined subsystems to the simulation model
load_system('trucklib')

% DriverTL ------------------------------------------------------------------
add_block('trucklib/DriverTL', strcat(file_name,'/DriverTL'),'Position', [130 120 230 300])
add_block('built-in/Clock',strcat(file_name,'/Clock'),'Position', [50 60 75 85])
add_block('built-in/ToWorkspace',strcat(file_name,'/Time'),'Position', [150 65 220 85])
set_param(strcat(file_name,'/Time'),'VariableName','s_time','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array')
add_line(strcat(file_name),'Clock/1','Time/1','autorouting','on')
add_line(strcat(file_name),'Clock/1','DriverTL/1','autorouting','on')
add_block('built-in/ToWorkspace',strcat(file_name,'/Delta'),'Position', [320 330 400 350])
set_param(strcat(file_name,'/Delta'),'VariableName','s_inputs_delta','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array')
add_line(strcat(file_name),'DriverTL/1','Delta/1','autorouting','on')
add_block('built-in/ToWorkspace',strcat(file_name,'/Throttle'),'Position', [320 365 400 385])
set_param(strcat(file_name,'/Throttle'),'VariableName','s_inputs_throttle','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array')
add_line(strcat(file_name),'DriverTL/2','Throttle/1','autorouting','on')
add_block('built-in/ToWorkspace',strcat(file_name,'/linear_brake'),'Position', [320 400 400 420])
set_param(strcat(file_name,'/linear_brake'),'VariableName','s_inputs_linear_brake','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array')
add_line(strcat(file_name),'DriverTL/3','linear_brake/1','autorouting','on')

add_block('built-in/ToWorkspace',strcat(file_name,'/valve_brake'),'Position', [320 435 400 455])
set_param(strcat(file_name,'/valve_brake'),'VariableName','s_inputs_valve_brake','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array')
add_line(strcat(file_name),'DriverTL/4','valve_brake/1','autorouting','on')

% Truck -------------------------------------------------------------------
add_block(strcat('trucklib/',truck_name), strcat(file_name,'/',truck_name),'Position', [300 120 420 300] )
add_line(strcat(file_name),'DriverTL/1',strcat(truck_name,'/1'),'autorouting','on')
add_line(strcat(file_name),'DriverTL/2',strcat(truck_name,'/2'),'autorouting','on')
add_line(strcat(file_name),'DriverTL/3',strcat(truck_name,'/3'),'autorouting','on')
add_line(strcat(file_name),'DriverTL/4',strcat(truck_name,'/4'),'autorouting','on')
add_line(strcat(file_name),'DriverTL/5',strcat(truck_name,'/5'),'autorouting','on')


% VR ToWorkspace ---------------------------------------------------------
add_block('built-in/ToWorkspace',strcat(file_name,'/VRTractor'),'Position', [460 160 530 180])
set_param(strcat(file_name,'/VRTractor'),'VariableName','VR_tractor','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Structure With Time')
add_line(strcat(file_name),strcat(truck_name,'/2'),'VRTractor/1','autorouting','on')


% Data ToWorkspace--------------------------------------------------------
add_block('built-in/Subsystem',strcat(file_name,'/ToWorkspace_',truck_name),'Position', [460 105 530 135])
add_block('built-in/Inport',strcat(file_name,'/ToWorkspace_',truck_name,'/In1'),'Position', [10 400 30 420])
add_line(strcat(file_name),strcat(truck_name,'/1'),strcat('ToWorkspace_',truck_name,'/1'),'autorouting','on')
% slip 1
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select_slip1'),'Position', [70 30 75 60])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select_slip1/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select_slip1'),'OutputSignals','steeraxle1.tyre1.longitudinal_slip')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/slip_1'),'Position', [170 30 270 60])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/slip_1'),'VariableName','s_steeraxle1_tyre1_longitudinal_slip','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select_slip1/1','slip_1/1')
% slip 2
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select_slip2'),'Position', [70 0 75 30])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select_slip2/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select_slip2'),'OutputSignals','steeraxle1.tyre2.longitudinal_slip')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/slip_2'),'Position', [170 0 270 30])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/slip_2'),'VariableName','s_steeraxle1_tyre2_longitudinal_slip','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select_slip2/1','slip_2/1')

% Brake torque 1
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select_Tbr1'),'Position', [70 -30 75 30])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select_Tbr1/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select_Tbr1'),'OutputSignals','steeraxle1.Mb_left')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/Tbr1'),'Position', [170 -30 270 30])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/Tbr1'),'VariableName','s_Tbr_steeraxle_left','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select_Tbr1/1','Tbr1/1')

% Brake torque 2
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select_Tbr2'),'Position', [70 -60 75 30])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select_Tbr2/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select_Tbr2'),'OutputSignals','steeraxle1.Mb_right')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/Tbr2'),'Position', [170 -60 270 30])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/Tbr2'),'VariableName','s_Tbr_steeraxle_right','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select_Tbr2/1','Tbr2/1')

    %Position of steer axle
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select1'),'Position', [70 60 75 90])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select1/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select1'),'OutputSignals','steeraxle1.centre_position')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/position'),'Position', [170 60 270 90])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/position'),'VariableName','s_steeraxle_pos','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select1/1','position/1')

    %GearBox Ratio
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select26'),'Position', [70 700 75 730])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select26/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select26'),'OutputSignals','driveline.gear_box.gear_ratio')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/gear_ratio'),'Position', [170 700 270 730])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/gear_ratio'),'VariableName','s_gear_ratio','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select26/1','gear_ratio/1')

    %GearBox Level
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select25'),'Position', [70 750 75 780])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select25/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select25'),'OutputSignals','driveline.gear_box.gear_num')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/gear_num'),'Position', [170 750 270 780])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/gear_num'),'VariableName','s_gear_num','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select25/1','gear_num/1')

    %Position of steer axle - right
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select24'),'Position', [70 800 75 830])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select24/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select24'),'OutputSignals','steeraxle1.steeraxle_posright')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/posright'),'Position', [170 800 270 830])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/posright'),'VariableName','s_steeraxle_posright','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select24/1','posright/1')

    %Position of steer axle - left
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select23'),'Position', [70 850 75 880])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select23/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select23'),'OutputSignals','steeraxle1.steeraxle_posleft')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/posleft'),'Position', [170 850 270 880])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/posleft'),'VariableName','s_steeraxle_posleft','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select23/1','posleft/1')

    %Position of front - right
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select21'),'Position', [70 900 75 930])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select21/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select21'),'OutputSignals','cabin.frontright_position')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/front_right'),'Position', [170 900 270 930])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/front_right'),'VariableName','s_cabinfront_rightpos','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select21/1','front_right/1')

    %Position of front - left
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select22'),'Position', [70 950 75 980])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select22/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select22'),'OutputSignals','cabin.frontleft_position')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/front_left'),'Position', [170 950 270 980])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/front_left'),'VariableName','s_cabinfront_leftpos','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select22/1','front_left/1')

    %Acceleration of steer axle 1
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select2'),'Position', [70 90 75 120])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select2/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select2'),'OutputSignals','steeraxle1.steeraxle_acc')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/acceleration_s1'),'Position', [170 90 270 120])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/acceleration_s1'),'VariableName','s_steeraxle1_acc','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select2/1','acceleration_s1/1')

    %Acceleration of steer axle 2
if a==4
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select3'),'Position', [70 130 75 160])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select3/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select3'),'OutputSignals','steeraxle2.steeraxle_acc')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/acceleration_s2'),'Position', [170 130 270 160])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/acceleration_s2'),'VariableName','s_steeraxle2_acc','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select3/1','acceleration_s2/1')
end

    %Acceleration of drive axle 1
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select4'),'Position', [70 180 75 210])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select4/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select4'),'OutputSignals','driveaxle1.driveaxle_acc')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/acceleration_d1'),'Position', [170 180 270 210])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/acceleration_d1'),'VariableName','s_driveaxle1_acc','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select4/1','acceleration_d1/1')

    %Acceleration of drive axle 2
if a>=3
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select5'),'Position', [70 230 75 260])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select5/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select5'),'OutputSignals','driveaxle2.driveaxle_acc')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/acceleration_d2'),'Position', [170 230 270 260])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/acceleration_d2'),'VariableName','s_driveaxle2_acc','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select5/1','acceleration_d2/1')
end

    %Acceleration of load
if t1>=2
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select6'),'Position', [70 280 75 310])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select6/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select6'),'OutputSignals','truckload.loadcenter_acc')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/acceleration_l'),'Position', [170 280 270 310])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/acceleration_l'),'VariableName','s_truckload_acc','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select6/1','acceleration_l/1')
end

    %Velocity of chassis
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select7'),'Position', [70 500 75 530])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select7/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select7'),'OutputSignals','chassis.Vx')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/velocity_chassis'),'Position', [170 500 270 530])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/velocity_chassis'),'VariableName','s_Vx','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select7/1','velocity_chassis/1')

    %Rotation velocity of engine
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select8'),'Position', [70 550 75 580])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select8/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select8'),'OutputSignals','driveline.omega')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/rot_vel_engine'),'Position', [170 550 270 580])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/rot_vel_engine'),'VariableName','s_engine_omega','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select8/1','rot_vel_engine/1')

    %Acceleration of chassis
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select9'),'Position', [70 600 75 630])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select9/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select9'),'OutputSignals','chassis.centre_acc')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/acceleration_chassis'),'Position', [170 600 270 630])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/acceleration_chassis'),'VariableName','s_chassis_acc','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select9/1','acceleration_chassis/1')

    %Torsion of chassis
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select10'),'Position', [70 650 75 680])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select10/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select10'),'OutputSignals','chassis.torsion')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/torsion_chassis'),'Position', [170 650 270 680])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/torsion_chassis'),'VariableName','s_chassis_torsion','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select10/1','torsion_chassis/1')

% Actual tire radius steeraxle1 left
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select111'),'Position', [300 260 305 290])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select111/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select111'),'OutputSignals','steeraxle1.tyre1.effective_rolling_radius','OutputAsBus','On')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/Radius_left'),'Position', [370 260 470 290])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/Radius_left'),'VariableName','s_Radius1','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select111/1','Radius_left/1')

% Actual tire radius steeraxle1 right
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select112'),'Position', [300 290 305 310])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select112/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select112'),'OutputSignals','steeraxle1.tyre2.effective_rolling_radius','OutputAsBus','On')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/Radius_right'),'Position', [370 290 470 310])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/Radius_right'),'VariableName','s_Radius2','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select112/1','Radius_right/1')

    %Tyres, longitudinal forces
if a==2
    tyre_list='steeraxle1.tyre1.Fx,steeraxle1.tyre2.Fx,driveaxle1.tyre1.Fx,driveaxle1.tyre2.Fx,driveaxle1.tyre3.Fx,driveaxle1.tyre4.Fx';
elseif a==3
    tyre_list='steeraxle1.tyre1.Fx,steeraxle1.tyre2.Fx,driveaxle1.tyre1.Fx,driveaxle1.tyre2.Fx,driveaxle1.tyre3.Fx,driveaxle1.tyre4.Fx,driveaxle2.tyre1.Fx,driveaxle2.tyre2.Fx,driveaxle2.tyre3.Fx,driveaxle2.tyre4.Fx';
elseif a==4
    tyre_list='steeraxle1.tyre1.Fx,steeraxle1.tyre2.Fx,steeraxle2.tyre1.Fx,steeraxle2.tyre2.Fx,driveaxle1.tyre1.Fx,driveaxle1.tyre2.Fx,driveaxle1.tyre3.Fx,driveaxle1.tyre4.Fx,driveaxle2.tyre1.Fx,driveaxle2.tyre2.Fx,driveaxle2.tyre3.Fx,driveaxle2.tyre4.Fx';
end
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select11'),'Position', [300 320 305 350])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select11/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select11'),'OutputSignals',tyre_list,'OutputAsBus','On')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/Tyres_Fx'),'Position', [370 320 470 350])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/Tyres_Fx'),'VariableName','s_tyre_tractorFx','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select11/1','Tyres_Fx/1')

    %Tyres, lateral forces
if a==2
    tyre_list='steeraxle1.tyre1.Fy,steeraxle1.tyre2.Fy,driveaxle1.tyre1.Fy,driveaxle1.tyre2.Fy,driveaxle1.tyre3.Fy,driveaxle1.tyre4.Fy';
elseif a==3
    tyre_list='steeraxle1.tyre1.Fy,steeraxle1.tyre2.Fy,driveaxle1.tyre1.Fy,driveaxle1.tyre2.Fy,driveaxle1.tyre3.Fy,driveaxle1.tyre4.Fy,driveaxle2.tyre1.Fy,driveaxle2.tyre2.Fy,driveaxle2.tyre3.Fy,driveaxle2.tyre4.Fy';
elseif a==4
    tyre_list='steeraxle1.tyre1.Fy,steeraxle1.tyre2.Fy,steeraxle2.tyre1.Fy,steeraxle2.tyre2.Fy,driveaxle1.tyre1.Fy,driveaxle1.tyre2.Fy,driveaxle1.tyre3.Fy,driveaxle1.tyre4.Fy,driveaxle2.tyre1.Fy,driveaxle2.tyre2.Fy,driveaxle2.tyre3.Fy,driveaxle2.tyre4.Fy';
end
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select12'),'Position', [300 370 305 400])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select12/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select12'),'OutputSignals',tyre_list,'OutputAsBus','On')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/Tyres_Fy'),'Position', [370 370 470 400])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/Tyres_Fy'),'VariableName','s_tyre_tractorFy','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select12/1','Tyres_Fy/1')

    %Tyres, vertical forces
if a==2
    tyre_list='steeraxle1.tyre1.Fz,steeraxle1.tyre2.Fz,driveaxle1.tyre1.Fz,driveaxle1.tyre2.Fz,driveaxle1.tyre3.Fz,driveaxle1.tyre4.Fz';
elseif a==3
    tyre_list='steeraxle1.tyre1.Fz,steeraxle1.tyre2.Fz,driveaxle1.tyre1.Fz,driveaxle1.tyre2.Fz,driveaxle1.tyre3.Fz,driveaxle1.tyre4.Fz,driveaxle2.tyre1.Fz,driveaxle2.tyre2.Fz,driveaxle2.tyre3.Fz,driveaxle2.tyre4.Fz';
elseif a==4
    tyre_list='steeraxle1.tyre1.Fz,steeraxle1.tyre2.Fz,steeraxle2.tyre1.Fz,steeraxle2.tyre2.Fz,driveaxle1.tyre1.Fz,driveaxle1.tyre2.Fz,driveaxle1.tyre3.Fz,driveaxle1.tyre4.Fz,driveaxle2.tyre1.Fz,driveaxle2.tyre2.Fz,driveaxle2.tyre3.Fz,driveaxle2.tyre4.Fz';
end
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select13'),'Position', [300 420 305 450])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select13/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select13'),'OutputSignals',tyre_list,'OutputAsBus','On')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/Tyres_Fz'),'Position', [370 420 470 450])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/Tyres_Fz'),'VariableName','s_tyre_tractorFz','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select13/1','Tyres_Fz/1')

    %Tyres, rotation velocity
if a==2
    tyre_list='steeraxle1.omega1,steeraxle1.omega2,driveaxle1.omega1,driveaxle1.omega2';
elseif a==3
    tyre_list='steeraxle1.omega1,steeraxle1.omega2,driveaxle1.omega1,driveaxle1.omega2,driveaxle2.omega1,driveaxle2.omega2';
elseif a==4
    tyre_list='steeraxle1.omega1,steeraxle1.omega2,steeraxle2.omega1,steeraxle2.omega2,driveaxle1.omega1,driveaxle1.omega2,driveaxle2.omega1,driveaxle2.omega2';
end
add_block('built-in/BusSelector',strcat(file_name,'/ToWorkspace_',truck_name,'/select14'),'Position', [300 470 305 500])
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'In1/1','select14/1','autorouting','on')
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/select14'),'OutputSignals',tyre_list,'OutputAsBus','On')
add_block('built-in/ToWorkspace',strcat(file_name,'/ToWorkspace_',truck_name,'/Tyres_omega'),'Position', [370 470 470 500])
set_param(strcat(file_name,'/ToWorkspace_',truck_name,'/Tyres_omega'),'VariableName','s_tyre_tractoromega','MaxDataPoints','inf','Decimation','1','SampleTime','-1','SaveFormat','Array','BackgroundColor','Orange')
add_line(strcat(file_name,'/ToWorkspace_',truck_name),'select14/1','Tyres_omega/1')

add_block('built-in/BusSelector',strcat(file_name,'/selector'),'Position',[60 240 65 270])
add_line(strcat(file_name),strcat(truck_name,'/1'),'selector/1','autorouting','on')
set_param(strcat(file_name,'/selector'),'OutputSignals','chassis.Vx')
add_line(strcat(file_name),'selector/1','DriverTL/2','autorouting','on')

add_block('built-in/BusSelector',strcat(file_name,'/selectored1'),'Position',[40 340 45 370])
add_line(strcat(file_name),strcat(truck_name,'/1'),'selectored1/1','autorouting','on')
set_param(strcat(file_name,'/selectored1'),'OutputSignals','steeraxle1.centre_position')
add_block('built-in/Gain',strcat(file_name,'/gain1'),'Position',[60 340 80 370])
set_param(strcat(file_name,'/gain1'),'Gain','[1 1 0]')
add_line(strcat(file_name),'selectored1/1','gain1/1','autorouting','on')
 
add_block('built-in/BusSelector',strcat(file_name,'/selectored2'),'Position',[40 380 45 410])
add_line(strcat(file_name),strcat(truck_name,'/1'),'selectored2/1','autorouting','on')
%driveaxle1 or driveaxle2 ?
if a==2 
    set_param(strcat(file_name,'/selectored2'),'OutputSignals','driveaxle1.centre_position')
elseif a==3 || a==4
    set_param(strcat(file_name,'/selectored2'),'OutputSignals','driveaxle2.centre_position')
end
add_block('built-in/Gain',strcat(file_name,'/gain2'),'Position',[60 380 90 410])
set_param(strcat(file_name,'/gain2'),'Gain','[1 1 0]')
add_line(strcat(file_name),'selectored2/1','gain2/1','autorouting','on')
 
add_block('built-in/Mux',strcat(file_name,'/mux_in'),'Position',[110 355 115 395])
set_param(strcat(file_name,'/mux_in'),'inputs','2')
add_line(strcat(file_name),'gain1/1','mux_in/1','autorouting','on')
add_line(strcat(file_name),'gain2/1','mux_in/2','autorouting','on')
add_line(strcat(file_name),'mux_in/1','DriverTL/3','autorouting','on')

fill_in_truck_model

save_system(file_name)

c=1;
p=p+1;

%% EXECUTE START MENU

configuration_selection

%% CLOSE WAIT SCREEN
jObj.stop;
closereq;